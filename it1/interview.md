# Список вопросов:

## Собеседование с IT-One:

-----------------------

# Вопросы из записи в iCloud (ИТ1 тех собес 1/2):

# ОПЫТ:

## 1. Есть что-то такое что запомнилось как большой успех? Не успех работы, а что приятно лично вспоминать. (ОПЫТ)
https://www.linkedin.com/in/vitalylobachev/details/experience/ - пример опыта работа Лабочева Виталия

**Достижения в работе**:

1. Рефакторинг и приведение к единому стандарту инфраструктуры команд Банка что позволяет экономить время на конфигурацию сервера/сервисов.
2. Документация всей проделанной работы на досках в Jira, в Confluence, в пайплайнах, скриптах и конфигах что позволяет экономить своё время и сотрудников на изучение инфры и обучение сотрудников.
3. Настройка мониторинга для всех команд (серверов, устройств, контейнеров, сервисов и бд)
4. Настройка CI/CD для тестирования, сборок и доставки кода для разных команд Банка.
5. Автоматизация нотификаций, очистки логов/данных на серверах, создания УЗ, регистрации раннеров, выпуска сертификатов.
6. Траблшутинг проблем, сетевых доступов и пайплайнов.

## 2. Факапы за время работы DevOps? (ОПЫТ)

1. Дали чужой PROD сервер с рабочим allure-server и запущенными приложениями. Не 1 сервер - 1 сервис, а прод сервер с 30 запущенными сервисами и регулярно запускающимися авто-тестами в несколько потоков.
    1. Согласился разобраться с проблемами на проблемном сервере.
    2. Не изучил всю архитектуру и не сразу нашел корень проблемы.
    3. Ко мне пришли с проблемой что отчеты перестали писаться на диск. Нехватка места или проблема с allure-server.
    4. На сервере были внесены изменения в конфигурации сотрудником и был ребут сервака.
    5. После ребута отлетели mount диски и я ЭТО не проверил/не нашел сразу.
    6. Отчеты стали писаться на другой диск. 
    7. Забилась /root директория с др диском. 
    8. Очистка памяти не помогала.
    9. Приложения падали с ошибкой из-за нехватки места.
    10. Не сразу нашел ссылки на директории, в которые писались логи. (Символические ссылки)
2. Потратил уйму времени на локализацию главной проблемы что диск был отмонтирован и повлёк за собой пачку проблем.

## 3. Нужно зайти на сервер и посмотреть потребление ресурсов. Процессор/Память/Диск/Сеть. Какими командами? (Linux)

Просмотр потребления ресурсов (процессор, память, диск, сеть) на сервере Linux:

1. `top`, `htop` - Онлайн просмотр MEMORY и CPU, NI (приоритет)

2. `free -h` - Просмотр использования памяти. 
    1. `lscpu` - информация о процессах
    2. `ps aux` - инфо о процессах (PID/USER/MEM/TIME/CPU)

3. `df -h`, `df -T`, `df -i` - Просмотр использования диска
    1. `du -axh --max-depth=1 /var` - folder used memory
    2. `tune2fs -l /dev/mapper/vg01-lv_var` - инфо по диску
    3. `ls -ltr | tail -1` - самый свежий файл
        1. `ls -lt | tail -1` - самый старый файл

4. `iftop`, `ip -s link` - Просмотр использования сети

5. `vgs` - volume groups

6. `iptables` - утилита для настройки правил брандмауэра в Linux. С помощью `iptables` можно управлять трафиком сетевых пакетов, определять, какие пакеты разрешены или блокированы, настраивать NAT (Network Address Translation), а также многое другое.

    Ключевые моменты об `iptables` (https://habr.com/ru/articles/747616/):

    1. **Таблицы**: `iptables` имеет различные таблицы, такие как `filter`, `nat`, `mangle`, `raw`, `security`. Каждая таблица используется для определенных целей, например, фильтрации пакетов (`filter`), NAT (`nat`), изменения заголовков пакетов (`mangle`).

    2. **Цепочки**: В рамках каждой таблицы существуют различные цепочки, такие как `INPUT`, `OUTPUT`, `FORWARD`. Цепочки определяют, куда направляются пакеты и какие правила применяются к ним.

    3. **Правила**: Правила `iptables` определяют, что делать с пакетами, которые проходят через брандмауэр. Правила могут разрешать, блокировать, перенаправлять или изменять пакеты в соответствии с заданными условиями.

    Через `iptables` можно просматривать текущие правила брандмауэра, смотреть статистику использования правил, добавлять новые правила, удалять и изменять существующие правила и т.д. 

    Например:

    1. `iptables -t nat -L` используется для просмотра правил NAT в таблице `nat`.
    2. `iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080` - для редиректа трафика с `--dport 80` до `--to-port 8080`
    3. `iptables -A INPUT -p tcp --dport 22 -m state --state NEW -m limit --limit 3/min -j ACCEPT` - для ограничения скорости
    4. `iptables -A INPUT -j LOG --log-prefix "Dropped Packet: " iptables -A INPUT -j DROP` - логирование всех отброшенных пакетов


## 4. Чем отличается системное от пользовательского времени (процессорное)? (Linux)

1. Пользовательское время — это время, затраченное процессором на выполнение команд, заданных пользовательской программой. 
2. Системное время — это время, затраченное на выполнение операционной системой и различными системными службами. 
3. Процессорное время может быть разделено между несколькими задачами или программами.

## 5. В Allure-server - ошибка: "No space left on device" и путь. df -h показывает что место есть. В чем проблема? (Linux)

1. Закончились Inodes (мета данные).
2. Проверю кол-во свободных инод на диске `df -i` или `df -ih`
3. Нужно увеличить размер диска что повлечет увеличение свободных inodes.
    1. Либо изменить файловую систему на более подходящую под задачи сервиса/сервера.
    2. `df -T` - fs Type: `ext4` (улучшенная версия ext3), `btrfs`, `XFS`, `FAT32`, `NTFS`:
        1. `ext4` - max размер раздела: 50-100тб, max размер файла: 16тб, max кол-во файлов - 4млрд
        2. `XFS` - max размер раздела: 8 экзабайт, max размер файла: 8 экзабайт, max кол-во файлов - 2 в 64 степени

## 6. Как потюнить Файловую систему? Какой командой её можно улучшить? (Linux)

Настройка и оптимизация файловой системы в Linux может повысить производительность и эффективность работы сервера. Одной из команд, которая может помочь улучшить файловую систему, является `tune2fs`.

`Tune2fs` - это утилита для настройки параметров файловых систем ext2/ext3/ext4. Некоторые параметры, которые можно настроить с помощью `tune2fs`:

1. **Интервал проверки файловой системы**: Можно изменить интервал проверки файловой системы на наличие ошибок при помощи опции `-c` (по количеству монтирований) или `-i` (по времени).

2. **Интервал записи журнала**: Можно изменить интервал записи журнала файловой системы с помощью опции `-J`.

3. **Размер журнала**: Можно изменить размер журнала файловой системы с помощью опции `-j`.

4. **Метка файловой системы**: Можно установить метку файловой системы с помощью опции `-L`.

5. **Максимальное количество монтирований**: Можно установить максимальное количество монтирований перед проверкой файловой системы с помощью опции `-C`.

Примеры использования `tune2fs`:

- Установить интервал проверки файловой системы на 30 дней:
```bash
sudo tune2fs -i 30d /dev/sdX
```

- Установить метку файловой системы:
```bash
sudo tune2fs -L "mylabel" /dev/sdX
```

## 7. Как поднять приоритет выполнения процесса на процессоре? (Linux)

Управлять приоритетом выполнения процессов с помощью утилиты `nice` или команды `renice`. 
Приоритет процесса определяет, как часто процесс получает доступ к процессорным ресурсам. Чем ниже значение приоритета, тем выше приоритет у процесса.

1. **Установка приоритета с помощью `nice`**:
   - Команда `nice` используется для запуска процесса с измененным приоритетом. Чем больше значение приоритета, тем ниже приоритет у процесса.
   - Пример установки приоритета процесса на 10: `nice -n 10 command`
   - В данном примере `command` - это команда, для которой вы хотите изменить приоритет.

2. **Изменение приоритета с помощью `renice`**:
   - Команда `renice` позволяет изменить приоритет уже запущенного процесса.
   - Пример изменения приоритета процесса с PID 123 на 5: `renice 5 -p 123`
   - В данном примере `123` - это идентификатор процесса.

3. **Просмотр текущего приоритета процессов**:
   - Для просмотра текущего приоритета процессов можно использовать команду `top` или `htop`. Приоритет отображается в столбце `NI` (nice value).

Важно помнить, что установка слишком высокого приоритета для процесса может привести к замедлению работы других процессов на системе. Рекомендуется быть осторожным при изменении приоритетов процессов и учитывать потребности других процессов на сервере.

## 8. Символические ссылки и жесткие ссылки. В чем разница? (Linux)

Символические ссылки (`symbolic links`) и жесткие ссылки (`hard links`) - это два способа создания ссылок на файлы в UNIX-подобных операционных системах, таких как Linux. Они имеют разные особенности и применения:

1. **Жесткие ссылки (hard links)**: `ln file1.txt hardlink.txt`
   - Жесткая ссылка - это второе (или более) имя файла, которое указывает на те же данные на диске, что и первое имя.
   - Жесткие ссылки работают только в пределах одной файловой системы.
   - Удаление исходного файла не влияет на жесткие ссылки, так как они указывают на те же данные на диске.
   - Жесткие ссылки не могут быть созданы для директорий.
   - Изменения в одном файле отразятся во всех его жестких ссылках, так как все они указывают на одни и те же данные.
   - Имеет одинаковый id c оригиналом

2. **Символические ссылки (symbolic links)**: `ln -s file1.txt softlink.txt`
   - Символическая ссылка - это специальный файл, который содержит путь к другому файлу или директории.
   - Символические ссылки могут пересекать границы файловых систем и могут указывать на файлы, которые еще не существуют.
   - Если исходный файл удален, символическая ссылка становится битой и не может быть использована.
   - Символические ссылки могут быть созданы для директорий.
   - Изменения в исходном файле не влияют на символическую ссылку, так как она просто содержит путь к файлу.
   - Имеет разные id c оригиналом и является ссылкой (другой тип файла и другой id)

В общем, жесткие ссылки обеспечивают более непосредственное соединение между файлами, в то время как символические ссылки предоставляют более гибкую возможность ссылаться на файлы. Каждый тип ссылок имеет свои особенности и применения, и выбор между ними зависит от конкретной задачи.

`ls -l` - для просмотра информации о ссылках на файлы в столбце links

## 9. Как ограничить процесс по потребляемой оперативной памяти? (Linux)

1. Ограничение потребления оперативной памяти контейнера `gitlab-runner-bank2` в 250MB:

    **Шаг 1:** Найти ID контейнера `gitlab-runner-bank2` - `docker ps`

    **Шаг 2:** Команда `docker stats gitlab-runner-bank2` чтобы увидеть текущее потребление оперативной памяти

    **Шаг 3:** Установить ограничение на потребление оперативной памяти контейнера `docker update --memory 250m gitlab-runner-bank2`


2. Создание процесса в Linux и установки ограничения на его потребление оперативной памяти в 250MB:

    **Шаг 1:** Файл `light_process.sh` для создания процесса:
    ```bash
    #!/bin/bash

    while true
    do
        echo "Light process is running..."
        sleep 1000
    done
    ```

    **Шаг 2**: Сделайте скрипт исполняемым: `chmod +x light_process.sh`

    **Шаг 3**: Запустите скрипт light_process.sh в фоновом режиме: `./light_process.sh &`

    **Шаг 4**: Найдите PID (идентификатор процесса) запущенного процесса, используя команду ps: `ps aux | grep light_process.sh`

    **Шаг 5**: Установите ограничение на потребление оперативной памяти для процесса, используя утилиту cgroups. Создайте cgroup с именем `memory_limit` и установите ограничение в 250MB:
    ```bash
    sudo mkdir /sys/fs/cgroup/memory/memory_limit
    echo 250M > /sys/fs/cgroup/memory/memory_limit/memory.limit_in_bytes
    echo $$ > /sys/fs/cgroup/memory/memory_limit/tasks
    ```

    **Шаг 6**: Посмотреть текущий лимит и после его обновления:
    ```bash
    cat /sys/fs/cgroup/memory/memory_limit/memory.limit_in_bytes 
    9223372036854771712

    echo 250M > /sys/fs/cgroup/memory/memory_limit/memory.limit_in_bytes

    cat /sys/fs/cgroup/memory/memory_limit/memory.limit_in_bytes 
    262144000
    ```
    **Шаг 7**: Добавить PID процесса в созданную группу:
    ```bash
    echo 3327922 > /sys/fs/cgroup/memory/process1/tasks
    cat /sys/fs/cgroup/memory/memory_limit/tasks
    3327922
    3328466
    3329874
    ```

## 10. Что такое DNS? (DNS)
Ответ есть в sber/education/interview.md

1. **Как работает DNS**:
   - **DNS (Domain Name System)** - это система, которая переводит доменные имена в IP-адреса и наоборот. Основные принципы работы DNS:
     - Когда вы вводите доменное имя в веб-браузере, ваш компьютер отправляет запрос DNS-серверу для получения соответствующего IP-адреса.
     - DNS-серверы содержат базы данных с записями DNS, которые соответствуют доменным именам IP-адресам.
     - DNS использует иерархическую структуру доменных имен, где домены разделены точками (например, sregistry.mts.ru).
     - Различные типы записей DNS включают A (IPv4-адрес), AAAA (IPv6-адрес), CNAME (каноническое имя), MX (почтовый сервер) и другие.

2. **Как настроить DNS**:
   - Для настройки DNS необходимо уметь работать с DNS-серверами, добавлять и изменять записи DNS, управлять зонами и кэшированием. Некоторые шаги настройки DNS:
     - Настройка DNS-сервера (например, BIND, Microsoft DNS).
     - Добавление и изменение записей DNS (A, CNAME, MX и т. д.) для привязки доменных имен к IP-адресам.
     - Управление зонами DNS, которые определяют, какие домены и поддомены обслуживает DNS-сервер.
     - Настройка кэширования DNS для ускорения процесса разрешения доменных имен.

3. **DNS безопасность**:
   - Для обеспечения безопасности DNS необходимо защищаться от DDoS-атак, DNS-подделок и других угроз безопасности. Некоторые методы защиты:
     - Использование DNSSEC (DNS Security Extensions) для обеспечения целостности и аутентичности данных DNS.
     - Настройка файрвола для блокировки нежелательных DNS-запросов и защиты от DDoS-атак.
     - Мониторинг и аудит DNS-трафика для обнаружения аномалий и подозрительной активности.
     - Регулярное обновление и усиление конфигурации DNS-серверов для предотвращения уязвимостей.

Чаще всего DevOps инженеры используют специализированные DNS-серверы, такие как BIND, PowerDNS, dnsmasq или другие, для управления DNS-зонами и обеспечения доступности и надежности DNS-сервиса.

Пример использования DNS на Ubuntu сервере Linux:
1. Установка DNS-сервера BIND:
```
sudo apt update
sudo apt install bind9
```

2. Настройка зоны DNS в файле `/etc/bind/named.conf.local`:
```bash
zone "sregistry.mts.ru" {
    type master;
    file "/etc/bind/zones/sregistry.mts.ru.zone";
};
```

3. Создание файла зоны `/etc/bind/zones/sregistry.mts.ru.zone` и добавление записей:
```bash
$TTL    604800
@       IN      SOA     ns1.sregistry.mts.ru. admin.sregistry.mts.ru. (
                2022010101  ; Serial
                604800      ; Refresh
                86400       ; Retry
                2419200     ; Expire
                604800 )    ; Negative Cache TTL
;
@       IN      NS      ns1.sregistry.mts.ru.
@       IN      A       192.168.1.10
www     IN      A       192.168.1.20
```

4. Перезапуск DNS-сервера для применения изменений: `sudo systemctl restart bind9`

Теперь сервер Ubuntu Linux будет использовать настроенный DNS-сервер для разрешения доменных имен в IP-адреса.

## 11. Какие бывают типы записей в DNS? (DNS)

Дополнительно к упомянутым типам записей DNS (A, AAAA, CNAME, MX), существуют и другие распространенные типы записей, вот некоторые из них:

1. **NS (Name Server)** - указывает на авторитетные DNS-серверы для конкретной зоны.
2. **PTR (Pointer)** - используется для обратного маппинга IP-адресов на доменные имена (reverse DNS lookup).
3. **TXT** - позволяет добавлять произвольный текстовый комментарий к доменному имени, часто используется для SPF (Sender Policy Framework) записей для электронной почты.
4. **SRV (Service)** - определяет местоположение службы в сети, таких как серверы электронной почты или VoIP.
5. **SOA (Start of Authority)** - содержит информацию об авторитетности зоны и параметры обслуживания.
6. **CAA (Certification Authority Authorization)** - определяет, какие сертификационные органы имеют право выдавать SSL-сертификаты для данного домена.
7. **SPF (Sender Policy Framework)** - определяет список IP-адресов, которые авторизованы отправлять электронную почту от имени домена.

## 12. Приведи примеры каждого типа записи. (DNS)

Примеры записей для типов A, AAAA, CNAME и MX:

1. **A (IPv4-адрес)**: 
   - Пример записи A: 
     ```
     sregistry.mts.ru. IN A 192.0.2.1
     ```
   В данном примере домен sregistry.mts.ru связан с IPv4-адресом 192.0.2.1.

2. **AAAA (IPv6-адрес)**: 
   - Пример записи AAAA: 
     ```
     sregistry.mts.ru. IN AAAA 2001:0db8:85a3:0000:0000:8a2e:0370:7334
     ```
   В данном примере домен sregistry.mts.ru связан с IPv6-адресом 2001:0db8:85a3:0000:0000:8a2e:0370:7334.

3. **CNAME (каноническое имя)**: 
   - Пример записи CNAME: 
     ```
     www.sregistry.mts.ru. IN CNAME sregistry.mts.ru.
     ```
   В данном примере поддомен www.sregistry.mts.ru перенаправляется на домен sregistry.mts.ru.

4. **MX (почтовый сервер)**: 
   - Пример записи MX: 
     ```
     sregistry.mts.ru. IN MX 10 mail.sregistry.mts.ru.
     ```
   В данном примере почтовые сообщения для домена sregistry.mts.ru будут отправляться на почтовый сервер mail.sregistry.mts.ru с приоритетом 10.

Каждая запись имеет свой синтаксис и структуру, которая определяет связь между доменным именем и соответствующими IP-адресами или другими серверами.

## 13. Команды и утилиты чтобы опросить DNS сервер. (DNS)

Существует несколько утилит и команд, которые можно использовать для опроса DNS-сервера и получения информации о доменных записях. Некоторые из наиболее распространенных утилит включают в себя `nslookup`, `dig`, `host` и `nsq`.

1. **nslookup**:
   - Пример использования:
     ```
     nslookup sregistry.mts.ru
     Name: sregistry.mts.ru
     Address: 11.215.144.1
     ```
   Эта команда позволяет выполнить DNS-запрос для домена sregistry.mts.ru и вывести информацию о соответствующих записях.

2. **host**:
   - Пример использования:
     ```bash
     host sregistry.mts.ru
     sregistry.mts.ru has address 11.215.144.1

     host -t MX mail.mtsbank.ru
     mail.mtsbank.ru is an alias for adns.mail.mtsbank.ru.
     ```
   Эта команда позволяет выполнить DNS-запрос для типа записи MX (почтовый сервер) для домена sregistry.mts.ru и вывести информацию о почтовом сервере.

3. **dig** (Domain Information Groper):
   - Пример использования:
     ```bash
     dig AAAA sregistry.mts.ru

     ; <<>> DiG 9.16.48-Ubuntu <<>> AAAA sregistry.mts.ru
     ;; global options: +cmd
     ;; Got answer:
     ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 60238
     ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

     ;; OPT PSEUDOSECTION:
     ; EDNS: version: 0, flags:; udp: 65494
     ;; QUESTION SECTION:
     ;sregistry.mts.ru.              IN      AAAA

     ;; Query time: 0 msec
     ;; SERVER: 127.0.0.53#53(127.0.0.53)
     ;; WHEN: Thu Feb 29 21:08:50 MSK 2024
     ;; MSG SIZE  rcvd: 45
     ```
   1. NOERROR - это означает, что запрос был выполнен успешно и не возникло ошибок.
   2. Ответ: ANSWER: 0 - это означает, что в ответе на запрос не было найдено записей AAAA (IPv6 адресов) для домена sregistry.mts.ru.
   3. Сервер DNS: SERVER: 127.0.0.53#53(127.0.0.53) - запрос был отправлен на локальный DNS сервер с IP-адресом 127.0.0.53.
   4. Время выполнения запроса: Query time: 0 msec - запрос был выполнен за очень короткое время.
   5. Из данного вывода следует, что для домена sregistry.mts.ru отсутствуют записи AAAA (IPv6 адресов). 

Эти утилиты и команды могут быть использованы для проверки доступности DNS-сервера, получения информации о доменных записях, а также для диагностики и анализа проблем с DNS.

## 14. У нас есть директория, у неё права 755. Что это обозначает? (Linux)

Права 755:
1. (4+2+1=7) - владелец файла имеет права на чтение, запись и выполнение
2. (4+0+1=5) - группа и остальные пользователи имеют права только на чтение и выполнение

## 15. Что означает "Выполнение" для директории? (Linux)

1. Право на чтение позволяет пользователю получить список содержимого папки. 
2. Право на запись позволяет создавать и удалять файлы в этой папке. 
3. Право на исполнение разрешает перейти в эту папку:
    1. `cd /Users/andreyshabunov/PhpstormProjects/devops-interviews` - перейти в директорию
    2. `ls -l /Users/andreyshabunov/PhpstormProjects/devops-interviews` - список файлов директории

## 16. У нас есть директория, у неё права 700. Нужно не меняя владельца и права добавить доступ кому-то для работы с этой директорией. Как это сделать? (Linux)

Утилита `setfacl` позволяет управлять расширенными списками контроля доступа (ACL) в Linux:

1. Установить ACL для директории, чтобы включить расширенные списки контроля доступа:
   ```
   setfacl -m u:pberyozkin_adm:rwx /home/ashabunov_adm/test
   ```
   Добавить доступ для pberyozkin_adm

2. Посмотреть текущие ACL для директории:
   ```
   getfacl /home/ashabunov_adm/test/
   ```

3. Вывод команды `getfacl /home/ashabunov_adm/test/`:
    ```
    getfacl: Removing leading '/' from absolute path names
    # file: home/ashabunov_adm/test/
    # owner: ashabunov_adm
    # group: docker
    user::rwx
    user:pberyozkin_adm:rwx         #effective:---
    group::r-x                      #effective:---
    mask::---
    other::---
    ```

## 17. AppArmor и SELinux профиль. Приходилось ли дебажить и настраивать?

`AppArmor` и `SELinux` - это две различные системы обязательного контроля доступа в Linux, которые обеспечивают дополнительный уровень безопасности для системы.

1. `AppArmor` (Application Armor) - это система контроля доступа, которая ограничивает возможности программ, устанавливая правила для их исполнения. AppArmor работает на уровне приложений и позволяет определить, какие ресурсы и операции приложение может использовать. Для настройки профилей безопасности в AppArmor используется специальный язык профилей.

2. `SELinux` (Security-Enhanced Linux) - это модуль ядра Linux, который предоставляет механизм обязательного контроля доступа на основе меток безопасности. SELinux управляет доступом к файлам, процессам, портам и другим ресурсам, определяя политики безопасности для различных объектов в системе.

Настройка профилей дебага и настройка в контексте AppArmor и SELinux может включать в себя определение правил доступа для конкретных приложений или сервисов, управление метками безопасности, а также настройку аудита и журналирования для отслеживания событий безопасности.

Обе системы обеспечивают возможность создания профилей безопасности для различных приложений и сервисов, что позволяет усилить защиту системы от различных угроз.

## 18. 





 
## Продолжить (ИТ1 тех собес 1/2) с 0:25:34